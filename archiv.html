<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Turnaje - LIGHTSMC.EU</title>
    <link rel="icon" type="image/jpeg" href="logo.jpeg">
    <style>
        /* POUŽIJTE STEJNÉ CSS JAKO V INDEX.HTML PRO NAVIGACI A BODY */
        :root { --bg: #05070a; --accent: #007bff; --glass: rgba(255, 255, 255, 0.03); --glass-border: rgba(255, 255, 255, 0.07); }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: white; margin: 0; background-image: radial-gradient(circle at 50% -20%, #001f3f, var(--bg)); }
        nav { background: rgba(5,7,10,0.8); backdrop-filter: blur(20px); border-bottom: 1px solid var(--glass-border); position: sticky; top:0; height:80px; display:flex; justify-content:center; }
        .nav-container { display:flex; width:100%; max-width:1200px; align-items:center; justify-content:center; position:relative; }
        .nav-link { color: rgba(255,255,255,0.6); text-decoration:none; padding:10px 18px; font-weight:600; font-size:0.85rem; text-transform:uppercase; }
        .nav-link.active { color:white; border-bottom:2px solid var(--accent); }
        .page { width:100%; max-width:900px; margin:auto; padding:60px 20px; }
        .card { background: var(--glass); border:1px solid var(--glass-border); padding:30px; border-radius:20px; margin-bottom:20px; position:relative; }
        .status-pill { display:inline-block; padding:4px 12px; border-radius:20px; font-size:10px; font-weight:800; margin-bottom:15px; background: #333; }
        .active-pill { background: #28a745; color:white; }
        input, textarea { width:100%; background:rgba(0,0,0,0.3); border:1px solid #333; color:white; padding:12px; border-radius:10px; margin-top:10px; }
        .admin-controls { position:absolute; right:20px; }
    </style>
</head>
<body>
    <nav><div class="nav-container">
        <div class="nav-links">
            <a href="index.html" class="nav-link">Domů</a>
            <a href="playoff.html" class="nav-link">PlayOff</a>
            <a href="kvalifikace.html" class="nav-link">Kvalifikace</a>
            <a href="pravidla.html" class="nav-link">Pravidla</a>
            <a href="archiv.html" class="nav-link active">Turnaje</a>
        </div>
        <div class="admin-controls">
            <a id="save-btn" class="nav-link" style="display:none; color:#28a745;">ULOŽIT</a>
            <a id="logout-btn" class="nav-link" style="display:none; color:#ff4d4d;">ODHLÁSIT</a>
        </div>
    </div></nav>
    <div class="page">
        <h1 style="text-align:center; margin-bottom:40px;">HISTORIE TURNAJŮ</h1>
        <button id="add-btn" style="display:none; width:100%; padding:15px; border-radius:12px; background:var(--accent); color:white; border:none; font-weight:bold; margin-bottom:30px;">+ NOVÝ TURNAJ (ADMIN)</button>
        <div id="container"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
        
        const firebaseConfig = { apiKey: "AIzaSyBwygFWO20kcMtOVuNT9hpfZPWTfGxNz_U", authDomain: "cspro-web.firebaseapp.com", projectId: "cspro-web", storageBucket: "cspro-web.firebasestorage.app", appId: "1:412820092666:web:cf2f3e419fd9b90b35bb43" };
        const app = initializeApp(firebaseConfig); const db = getFirestore(app); const auth = getAuth(app);

        let isAdmin = false; let seasons = {};

        onAuthStateChanged(auth, user => {
            isAdmin = user && user.providerData.some(p => p.providerId === 'password');
            if(isAdmin) { 
                document.getElementById('save-btn').style.display='block'; 
                document.getElementById('logout-btn').style.display='block'; 
                document.getElementById('add-btn').style.display='block'; 
            }
            render();
        });

        onSnapshot(doc(db, "tournament", "archive_list"), d => { if(d.exists()) { seasons = d.data(); render(); } });

        function render() {
            const cont = document.getElementById('container'); cont.innerHTML = "";
            Object.keys(seasons).sort().reverse().forEach(id => {
                const s = seasons[id]; const card = document.createElement('div'); card.className = "card";
                card.innerHTML = `
                    <div class="status-pill ${s.active ? 'active-pill':''}">${s.active ? 'AKTIVNÍ':'ARCHIV'}</div>
                    <h2 style="margin:0">${s.title}</h2>
                    <p style="color:#777">${s.desc}</p>
                    ${isAdmin ? `
                        <input id="t_${id}" value="${s.title}">
                        <textarea id="d_${id}">${s.desc}</textarea>
                        <button onclick="window.act('${id}')" style="margin-top:10px;">AKTIVOVAT</button>
                        <button onclick="window.del('${id}')" style="color:red">SMAZAT</button>
                    `:''}
                `;
                cont.appendChild(card);
            });
        }

        window.act = id => { Object.keys(seasons).forEach(k => seasons[k].active = false); seasons[id].active = true; save(); };
        window.del = id => { if(confirm("Smazat?")) { delete seasons[id]; save(); } };
        async function save() { await setDoc(doc(db, "tournament", "archive_list"), seasons); }
        document.getElementById('save-btn').onclick = () => {
            Object.keys(seasons).forEach(id => {
                seasons[id].title = document.getElementById(`t_${id}`).value;
                seasons[id].desc = document.getElementById(`d_${id}`).value;
            });
            save(); alert("Uloženo");
        };
        document.getElementById('add-btn').onclick = () => { seasons[Date.now()] = {title:"Nový", desc:"...", active:false}; render(); };
        document.getElementById('logout-btn').onclick = () => signOut(auth).then(() => location.reload());
    </script>
</body>
</html>
