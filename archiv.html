<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Spr√°va turnaj≈Ø - CSPRO.CZ</title>
    <style>
        :root { --bg-color: #0f0f0f; --accent-color: #f3a933; --card-bg: #1a1a1a; --danger: #ff4d4d; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: white; margin: 0; display: flex; flex-direction: column; align-items: center; }
        nav { background: #1a1a1a; width: 100%; display: flex; justify-content: center; border-bottom: 2px solid var(--accent-color); position: sticky; top: 0; z-index: 1000; }
        .nav-link { color: white; text-decoration: none; padding: 20px; font-weight: bold; text-transform: uppercase; font-size: 0.9em; cursor: pointer; }
        .nav-link:hover { color: var(--accent-color); background: #222; }
        .page { width: 900px; padding: 40px; }
        
        .card { background: var(--card-bg); padding: 25px; border-radius: 12px; border-left: 5px solid var(--accent-color); margin-bottom: 20px; position: relative; transition: 0.3s; }
        .active-badge { position: absolute; top: 10px; right: 10px; display: flex; align-items: center; gap: 5px; font-size: 0.8em; }
        
        h1 { color: var(--accent-color); letter-spacing: 2px; }
        input, textarea { background: #222; border: 1px solid #333; color: white; padding: 10px; border-radius: 5px; width: 100%; box-sizing: border-box; margin-bottom: 10px; font-family: inherit; }
        textarea { height: 60px; resize: none; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 0.8em; }
        .btn-add { background: var(--accent-color); color: black; margin-bottom: 20px; }
        .btn-save { background: #4caf50; color: white; }
        .btn-del { background: var(--danger); color: white; margin-top: 10px; }
        
        .admin-controls { display: none; margin-top: 30px; border-top: 1px solid #333; padding-top: 20px; }
    </style>
</head>
<body>
    <nav>
        <a href="index.html" class="nav-link">Dom≈Ø</a>
        <a href="playoff.html" class="nav-link">PlayOff</a>
        <a href="kvalifikace.html" class="nav-link">Kvalifikace</a>
        <a href="pravidla.html" class="nav-link">Pravidla</a>
        <a href="archiv.html" class="nav-link" style="color:var(--accent-color)">Archiv</a>
        <a id="logout-btn" class="nav-link" style="display:none; color:var(--danger)">ODHL√ÅSIT</a>
    </nav>

    <div class="page">
        <h1 id="page-title">ARCHIV TURNAJ≈Æ</h1>
        
        <div id="seasons-container">
            </div>

        <div id="admin-area" class="admin-controls">
            <button class="btn btn-add" id="add-season">+ P≈òIDAT NOV√ù TURNAJ</button>
            <button class="btn btn-save" id="save-btn">ULO≈ΩIT V≈†ECHNY ZMƒöNY</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyBwygFWO20kcMtOVuNT9hpfZPWTfGxNz_U", 
            authDomain: "cspro-web.firebaseapp.com", 
            projectId: "cspro-web", 
            storageBucket: "cspro-web.firebasestorage.app", 
            messagingSenderId: "412820092666", 
            appId: "1:412820092666:web:cf2f3e419fd9b90b35bb43" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let seasonsData = {};
        let isAdmin = false;

        // Kontrola admina
        onAuthStateChanged(auth, user => {
            isAdmin = !!user;
            document.getElementById('admin-area').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('logout-btn').style.display = isAdmin ? 'block' : 'none';
            if(isAdmin) document.getElementById('page-title').innerText = "SPR√ÅVA TURNAJ≈Æ";
            render();
        });

        // Naƒçten√≠ dat
        onSnapshot(doc(db, "tournament", "archive_list"), d => {
            if(d.exists()) {
                seasonsData = d.data();
                render();
            }
        });

        function render() {
            const container = document.getElementById('seasons-container');
            container.innerHTML = "";
            
            // Se≈ôazen√≠ - aktivn√≠ turnaj naho≈ôe
            const sortedIds = Object.keys(seasonsData).sort((a,b) => seasonsData[b].active - seasonsData[a].active);

            sortedIds.forEach(id => {
                const s = seasonsData[id];
                const card = document.createElement('div');
                card.className = "card";
                
                if(!isAdmin) {
                    // Verze pro bƒõ≈æn√©ho div√°ka
                    card.innerHTML = `
                        <div class="active-badge">${s.active ? 'üü¢ AKTIVN√ç' : '‚ö™ UKONƒåENO'}</div>
                        <h3>${s.title}</h3>
                        <p>${s.desc}</p>
                    `;
                } else {
                    // Verze pro admina (editovateln√°)
                    card.innerHTML = `
                        <div class="active-badge">
                            AKTIVN√ç: <input type="radio" name="active_t" ${s.active ? 'checked' : ''} id="radio_${id}" style="width:20px; margin:0">
                        </div>
                        <input type="text" value="${s.title}" id="t_${id}" placeholder="N√°zev turnaje">
                        <textarea id="d_${id}" placeholder="Kr√°tk√Ω popis">${s.desc}</textarea>
                        <button class="btn btn-del" id="del_${id}">SMAZAT TURNAJ</button>
                    `;
                    
                    // Eventy pro admina
                    setTimeout(() => {
                        document.getElementById(`radio_${id}`).addEventListener('change', (e) => {
                            Object.keys(seasonsData).forEach(key => seasonsData[key].active = false);
                            seasonsData[id].active = e.target.checked;
                            render();
                        });
                        document.getElementById(`del_${id}`).addEventListener('click', () => {
                            if(confirm("Opravdu chcete tento turnaj smazat?")) {
                                delete seasonsData[id];
                                render();
                            }
                        });
                        document.getElementById(`t_${id}`).addEventListener('input', (e) => seasonsData[id].title = e.target.value);
                        document.getElementById(`d_${id}`).addEventListener('input', (e) => seasonsData[id].desc = e.target.value);
                    }, 0);
                }
                container.appendChild(card);
            });
        }

        document.getElementById('add-season').addEventListener('click', () => {
            const id = "t" + Date.now();
            seasonsData[id] = { title: "Nov√Ω turnaj", desc: "", active: false };
            render();
        });

        document.getElementById('save-btn').addEventListener('click', async () => {
            try {
                await setDoc(doc(db, "tournament", "archive_list"), seasonsData);
                alert("V≈°echny zmƒõny byly ulo≈æeny!");
            } catch (e) {
                alert("Chyba p≈ôi ukl√°d√°n√≠: " + e.message);
            }
        });

        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth).then(() => window.location.reload()));
    </script>
</body>
</html>
