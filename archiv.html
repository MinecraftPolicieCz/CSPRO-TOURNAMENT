<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Spr√°va turnaj≈Ø - CSPRO.CZ</title>
    <style>
        :root { --bg-color: #0f0f0f; --accent-color: #f3a933; --card-bg: #1a1a1a; --danger: #ff4d4d; --success: #4caf50; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: white; margin: 0; display: flex; flex-direction: column; align-items: center; }
        
        nav { background: #1a1a1a; width: 100%; display: flex; justify-content: center; border-bottom: 2px solid var(--accent-color); position: sticky; top: 0; z-index: 1000; }
        .nav-link { color: white; text-decoration: none; padding: 20px; font-weight: bold; text-transform: uppercase; font-size: 0.9em; cursor: pointer; transition: 0.3s; }
        .nav-link:hover { color: var(--accent-color); background: #222; }

        .page { width: 900px; padding: 40px; }
        h1 { color: var(--accent-color); letter-spacing: 2px; text-transform: uppercase; text-align: center; }
        
        .card { background: var(--card-bg); padding: 25px; border-radius: 12px; border-left: 5px solid #333; margin-bottom: 20px; position: relative; transition: 0.3s; }
        .card.active-card { border-left-color: var(--success); background: #1e251e; }
        
        .active-badge { position: absolute; top: 15px; right: 15px; }
        
        input, textarea { background: #222; border: 1px solid #333; color: white; padding: 12px; border-radius: 5px; width: 100%; box-sizing: border-box; margin-bottom: 10px; font-family: inherit; }
        textarea { height: 80px; resize: none; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 0.75em; transition: 0.2s; }
        .btn-add { background: var(--accent-color); color: black; margin-bottom: 30px; width: 100%; font-size: 1em; }
        .btn-del { background: var(--danger); color: white; margin-top: 5px; }
        .btn-toggle { background: #444; color: white; min-width: 100px; }
        .btn-toggle.on { background: var(--success); }

        #save-btn, #logout-btn { display: none; } /* Skryto pro nehl√°≈°en√© */
    </style>
</head>
<body>
    <nav>
        <a href="index.html" class="nav-link">Dom≈Ø</a>
        <a href="playoff.html" class="nav-link">PlayOff</a>
        <a href="kvalifikace.html" class="nav-link">Kvalifikace</a>
        <a href="pravidla.html" class="nav-link">Pravidla</a>
        <a href="archiv.html" class="nav-link" style="color:var(--accent-color)">Archiv</a>
        <a id="save-btn" class="nav-link" style="color:var(--success)">ULO≈ΩIT ZMƒöNY</a>
        <a id="logout-btn" class="nav-link" style="color:var(--danger)">ODHL√ÅSIT</a>
    </nav>

    <div class="page">
        <h1 id="page-title">Archiv turnaj≈Ø</h1>
        
        <div id="admin-add-area" style="display:none">
            <button class="btn btn-add" id="add-btn">+ VYTVO≈òIT NOV√ù TURNAJ</button>
        </div>

        <div id="seasons-container"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyBwygFWO20kcMtOVuNT9hpfZPWTfGxNz_U", 
            authDomain: "cspro-web.firebaseapp.com", 
            projectId: "cspro-web", 
            storageBucket: "cspro-web.firebasestorage.app", 
            messagingSenderId: "412820092666", 
            appId: "1:412820092666:web:cf2f3e419fd9b90b35bb43" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let seasonsData = {};
        let isAdmin = false;

        // Spr√°va stavu p≈ôihl√°≈°en√≠
        onAuthStateChanged(auth, user => {
            isAdmin = !!user;
            document.getElementById('save-btn').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('logout-btn').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('admin-add-area').style.display = isAdmin ? 'block' : 'none';
            
            if(isAdmin) document.getElementById('page-title').innerText = "Spr√°va turnaj≈Ø";
            render();
        });

        // Naƒç√≠t√°n√≠ dat z Firebase
        onSnapshot(doc(db, "tournament", "archive_list"), d => {
            if(d.exists()) { 
                seasonsData = d.data(); 
                render(); 
            }
        });

        // Vykreslen√≠ seznamu turnaj≈Ø
        function render() {
            const container = document.getElementById('seasons-container');
            container.innerHTML = "";
            const sortedIds = Object.keys(seasonsData).sort((a,b) => seasonsData[b].active - seasonsData[a].active);

            sortedIds.forEach(id => {
                const s = seasonsData[id];
                const card = document.createElement('div');
                card.className = "card" + (s.active ? " active-card" : "");
                
                if(!isAdmin) {
                    // Verze pro div√°ky
                    card.innerHTML = `
                        <div style="color:${s.active ? '#4caf50' : '#777'}; font-weight:bold; font-size:0.8em; margin-bottom:5px">
                            ${s.active ? 'üü¢ AKTU√ÅLN√ç' : '‚ö™ UKONƒåENO'}
                        </div>
                        <h2 style="margin:0">${s.title}</h2>
                        <p style="color:#bbb; margin-top:10px">${s.desc}</p>
                    `;
                } else {
                    // Verze pro admina
                    card.innerHTML = `
                        <div class="active-badge">
                            <button class="btn btn-toggle ${s.active ? 'on' : ''}" id="toggle_${id}">
                                ${s.active ? 'AKTIVN√ç' : 'VYPNUTO'}
                            </button>
                        </div>
                        <input type="text" value="${s.title}" id="t_${id}" placeholder="N√°zev turnaje">
                        <textarea id="d_${id}" placeholder="Popis turnaje">${s.desc}</textarea>
                        <button class="btn btn-del" id="del_${id}">SMAZAT</button>
                    `;
                    
                    setTimeout(() => {
                        // P≈ôep√≠n√°n√≠ aktivity (jen jeden m≈Ø≈æe b√Ωt aktivn√≠)
                        document.getElementById(`toggle_${id}`).onclick = () => {
                            const wasActive = seasonsData[id].active;
                            Object.keys(seasonsData).forEach(k => seasonsData[k].active = false);
                            seasonsData[id].active = !wasActive;
                            render();
                        };
                        // Maz√°n√≠
                        document.getElementById(`del_${id}`).onclick = () => {
                            if(confirm("Opravdu smazat tento turnaj?")) { 
                                delete seasonsData[id]; 
                                render(); 
                            }
                        };
                        // Update dat v lok√°ln√≠ promƒõnn√©
                        document.getElementById(`t_${id}`).oninput = (e) => seasonsData[id].title = e.target.value;
                        document.getElementById(`d_${id}`).oninput = (e) => seasonsData[id].desc = e.target.value;
                    }, 0);
                }
                container.appendChild(card);
            });
        }

        // Tlaƒç√≠tko p≈ôidat v tƒõle str√°nky
        document.getElementById('add-btn').onclick = () => {
            const id = "t" + Date.now();
            seasonsData[id] = { title: "Nov√Ω turnaj", desc: "Popis v√≠tƒõz≈Ø...", active: false };
            render();
        };

        // Tlaƒç√≠tko ulo≈æit v NAVIGACI
        document.getElementById('save-btn').onclick = async () => {
            try {
                await setDoc(doc(db, "tournament", "archive_list"), seasonsData);
                alert("Zmƒõny byly √∫spƒõ≈°nƒõ ulo≈æeny do datab√°ze!");
            } catch (e) { 
                alert("Chyba p≈ôi ukl√°d√°n√≠: " + e.message); 
            }
        };

        // Odhl√°≈°en√≠
        document.getElementById('logout-btn').onclick = () => signOut(auth).then(() => window.location.reload());
    </script>
</body>
</html>
